import{r as i,j as a,C as B,a as H,S as O,E as b}from"./index-CS1wzTC4.js";import{C as S}from"./ChartButtonBox-CmQO1tEp.js";const F=300,M=.7,k=.5,w=.3,x=["Recruit","Prospect","Contender","Challenger","Elite","Premier"];function $({playerData:l=[]}){const[v,A]=i.useState([]),[y,L]=i.useState([]),[n,j]=i.useState("mmr"),f=t=>{j(t)},p=i.useCallback((t,e,u,c)=>t>=e||t<=-e?"red":t>=u||t<=-u?"orange":t>=c||t<=-c?"yellow":"green",[]),h=i.useMemo(()=>l.length>0&&l[0].stats?Object.keys(l[0].stats):[],[l]);return i.useEffect(()=>{(async()=>{const t=navigator.hardwareConcurrency||4,e=Math.ceil(x.length/t),c=Array.from({length:t},(r,s)=>x.slice(s*e,s*e+e)).map((r,s)=>{const d=new Worker("./correlation-worker.js");return d.postMessage({playerData:l,tiers:r,statsKeys:h,ratingKey:n}),d}),o=await Promise.all(c.map(r=>new Promise((s,d)=>{const E=m=>{r.removeEventListener("message",E),r.terminate(),Array.isArray(m.data)&&m.data.every(g=>Array.isArray(g)&&g.length===2&&typeof g[0]=="string"&&Array.isArray(g[1])&&g[1].every(R=>typeof R=="number"||R===void 0))?s(m.data):d(new Error("Invalid data format from worker."))},C=m=>{r.removeEventListener("error",C),r.terminate(),d(m.message)};r.addEventListener("message",E),r.addEventListener("error",C)})));L(o.flat())})()},[l,h,n]),i.useEffect(()=>{const t=h.map((e,u)=>{if(e!=="rating"){const c=y.map(([o,r])=>{const s=r[u];if(typeof s=="number")return{value:s,itemStyle:{color:p(s,M,k,w)}}}).filter(o=>o!==void 0);return{title:{text:`Correlation - ${n==="mmr"?n.toUpperCase():n.charAt(0).toUpperCase()+n.slice(1)} and ${e}`,left:"5%",top:"5%",textStyle:{align:"center",color:"#FFFFFF"}},xAxis:{type:"category",data:x,axisLabel:{interval:0,rotate:45}},yAxis:{type:"value",name:""},tooltip:{trigger:"axis",formatter:function(o){return`${o[0].axisValueLabel}: ${o[0].value.toFixed(2)}`}},grid:{left:"5%",right:"5%",top:"20%",bottom:"5%",containLabel:!0},series:[{type:"bar",data:c}]}}return null}).filter(e=>e!==null);A(t)},[y,p,h,n]),a.jsxs(a.Fragment,{children:[a.jsxs(B,{children:[a.jsx(S,{isSelected:n==="mmr",onClick:()=>f("mmr"),children:"MMR"}),a.jsx(S,{isSelected:n==="rating",onClick:()=>f("rating"),children:"Rating"})]}),a.jsx(H,{children:v.map(t=>a.jsx(O,{children:a.jsx(b,{option:t,className:"w-full",style:{height:F},notMerge:!0})},`chart-${t.title.text}`))})]})}export{$ as CorrelationByTier};
